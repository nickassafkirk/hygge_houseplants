{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container my-5">
    <h2>Add Product</h2>
    <hr>
    <form action="{% url 'add_product' %}" method="POST" id="add-product-form" enctype="multipart/form-data">
        {% csrf_token %}
        {% for field in product_form %}
            {% if field.name == "has_variants" %}
            <hr>
            <label for="{{ field.auto_id }}" class="me-2">{{ field.label }}</label>
               {{ field }}
            {% elif field.name == "available" %}
            <label for="{{ field.auto_id }}" class="ms-5 me-2">{{ field.label }}</label>
               {{ field }}   
            {% else %}   
                {{ field | as_crispy_field }}
            {% endif %}
        {% endfor %}
        
        <div id="add-variants-form" class="d-none mt-3">
            <h5>Add Variants</h5>
            {{ variant_form | crispy }}
        </div>
        
        <div class="my-2">
            <hr>
            <button type="submit" class="btn btn-dark" id="add-product-btn">
                <i class="fas fa-plus-circle"></i>
                <br>
                Create Product
            </button>
        </div> 
    </form>

    <!-- Variants Form -->
    {% include 'products/includes/add_variants.html' %}

</div>

{% endblock %}

{% block footerjs %}

<script type="text/javascript">

    $('#has_variants').change( function() {
        console.log(this.checked)
        if (this.checked === true) {
            $('#add-variants-form').removeClass('d-none')
        } else {
            $('#add-variants-form').addClass('d-none')
        }
    })
    
    $('#new-image').change(previewImage);

    function previewImage() {

        existingImage = document.getElementById('image-preview-container')
        if (existingImage != null) {
            existingImage.remove();
        }

        let file = document.querySelector('#new-image').files[0];
        console.log(file)
        let reader = new FileReader();

        reader.onload = function(e) {
            let formImageSection = document.getElementById('div_id_product_form-image');

            let imageContainer = document.createElement('div');
            imageContainer.id = "image-preview-container";

            let image = document.createElement('img');
            image.id = 'image-preview'
            image.src = e.target.result;

            let deleteIcon = document.createElement('div');
            deleteIcon.id = "delete-icon";
            deleteIcon.innerHTML = `<i class="fas fa-times-circle"></i>`;

            formImageSection.appendChild(imageContainer);
            imageContainer.appendChild(image);
            imageContainer.appendChild(deleteIcon);  
        }
        reader.readAsDataURL(file);
    }

    function clearExistingImage() {

    }

    

</script>

{% endblock %}