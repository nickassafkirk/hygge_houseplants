{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid my-5">
    <div class="row">
        <div class="col-12 product-path ms-2 mb-5">
            <a href="{% url 'index' %}">Home</a> /
            <a href="{% url 'products' %}">Products</a> /
            <a href="{% url 'products' %}?category={{ product.category }}">{{ product.category | title }}</a> /
            <a href="{% url 'single_product' product.id %}">Product/{{product.id}}</a>
        </div>
        <ul class="hidden-variants ">
            {% for variant in variants %}
                <li id="variant-{{ variant.id}}" data-var_img="{{ variant.image.url }}" data-var_price="{{ variant.price }}" data-var_qty="{{ variant.quantity }}"></li>
            {% endfor %}
        </ul>
        <div class="col-12 col-sm-6 col-lg-4 offset-lg-2">
            <div class="row">
                <div class="col-12 single-product-img-container p-0">
                    <img src="{% if product.image %}{{ product.image.url }}{% else %}{{ MEDIA_URL }}hero1.jpg{% endif %}" alt="{{ product.name }}" class="single-product-img" id="main-product-img">
                </div>
            </div>
            {% if variants %}
                <div class="row">
                    {% for variant in variants %}
                        {% if variant.image %}
                            <div class="col-4 ps-3 pt-3">
                                <img src="{{ variant.image.url }}" class="thumbnail-img" alt="{{ variant.name }}">
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>     
            {% endif %}
        </div>
        <div class="col-12 col-sm-6 col-lg-4 mt-3 mt-sm-0">
            <h3 class="px-3 px-lg-5">{{ product.name }}</h3>
            <h4 class="px-3 px-lg-5" id="product-price">€{{ product.price }}</h4>
            <hr>
            
            <p class="px-3 px-lg-5" id="product-availability"><strong>Availability: </strong>
                {% if product.quantity > 0 %}
                <span class="text-success">{{ product.quantity }} In Stock</span>
                {% else %}
                <span class="text-danger">Sold Out</span>
                {% endif %}
            </p>
            
            <form action="{% url 'add_to_cart' product.id %}" method="POST" class="row px-3 px-lg-5">
                {% csrf_token %}
                
                <div class="col-8">
                    {% if variants %}
                        <select class="form-select" name="variant-select" id="variant-select">
                            {% for variant in variants %}
                                <option value="{{ variant.id }}">{{ variant.color | title }} - {{ variant.size | upper }}</option>
                            {% endfor %}
                        </select>
                    {% endif %}
                </div>
                <div class="col-4">
                    <input class="form-control" name="add-to-cart-quantity" id="add-to-cart-quantity" type="number" value="1">
                </div>
                <div class="col-12 mt-2">
                    <button type="submit" class="btn btn-bright w-100 p-2">Add to Cart <i class="fas fa-cart-plus"></i></button>
                </div>
            </form>

            {% if request.user.is_superuser %}
            <div class="px-3 px-lg-5 mt-5">
                <a href="{% url 'edit_product' product.id %}" class="text-info">Edit Product</a> | <a href="{% url 'delete_product' product.id %}" class="text-danger">Delete Product</a>
            </div>
            {% endif %}
        </div>
        <div class="col-12 col-lg-8 offset-lg-2">
            <hr>
            <p class="px-3 px-lg-5">{{ product.description }}</p>
        </div>
    </div>
    
</div>
{% endblock %}

{% block footerjs %}
<script type="text/javascript">

    $('#variant-select').change(function(){
        // Get Variant ID
        let currentVariantId = $(this).val();
        let currentVariant = $(`#variant-${currentVariantId}`);
        // Get Variant Img from hidden variant info
        let currentVariantImg = currentVariant.attr('data-var_img');
        let mainProductImage = $('#main-product-img');
        // reset main product value
        mainProductImage.attr('src', currentVariantImg);
        
        // repeat for price
        let currentVariantPrice = currentVariant.attr('data-var_price');
        let mainProductPrice = $('#product-price');
        mainProductPrice.text(`€${currentVariantPrice}`);
        
        // repeat for quantity
        let currentVariantQty = currentVariant.attr('data-var_qty');
        let productAvailablity = $('#product-availability');
        if (currentVariantQty > 0) {
            productAvailablity.html(
                `<strong>Availability: </strong>
                <span class="text-success">${currentVariantQty} In Stock</span>
                `
            )
        } else {
            productAvailablity.html(
                `<strong>Availability: </strong>
                <span class="text-danger">Sold Out</span>
                `
            )
        } 
    })
</script>
{% endblock %}

